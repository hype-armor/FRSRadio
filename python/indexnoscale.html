<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <title>FRS Radio Project</title>
    <script src="js/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="js/loader.js"></script>
    <script>
        function loadtemp(){
            $.get('http://localhost:8000/data', function(data) {
              text = data.split(",");
              
              i = 0;

              // known data points
              rpm = text[i++];
              accelerator = text[i++];
              brake = text[i++];
              clutchStatus = text[i++];
              fuelFlow = text[i++];
              gear = text[i++];
              mph = text[i++];
              steeringAngle = text[i++];
              pitch = text[i++];
              roll = text[i++];
              sportMode = text[i++];

              // unknowns
              zero = text[11];
              //one = text[12];
              two = text[12];
              three = text[16];
              four = text[17];
              five = text[19];
              six = mph;
              //seven = text[18];

              threads--;
            }, "text").fail(function (){
                    skip = 20;
                    threads--;
            });
        };
        function scale(options, value){
          if (options.min > value && value > 0) {
          	options.min -= Math.round(value * 1);
            options.hitmin = true
          }
          else if (options.min > value && value < 0) {
          	options.min += Math.round(value * 1);
            options.hitmin = true
          }
          else if (options.min < value && options.hitmin == false) {
          	options.min = Math.round(value * 1);
          }

          if (options.max < value && value > 0) {
          	options.max += Math.round(value * 1);
            options.hitmax = true;
          }
          else if (options.max < value && value < 0) {
          	options.max -= Math.round(value * 1);
            options.hitmax = true;
          }
          else if (options.max > value && options.hitmax == false) {
          	options.max = Math.round(value * 1);
          }
          return options;
        };
        $(document).ready(function(){
            skip = 0;
            threads = 16;
            setInterval(function(){
                if (skip == 0 && threads <= 16)
                {
	                  threads++;
                    loadtemp();
                }
                else if (skip > 0)
                {
                    skip--;
                }
            }, 100);
        });
    </script>
</head>

<body style="background-color:black;"> 
  <table style="width: 650px; height:460px;" align="center">
  <tr>
    <td>
      
      <div id="zeroChart"></div>
    </td>
    <td>
      <div id="twoChart"></div>
    </td>
    <td>
      <div id="threeChart"></div>
    </td>
  </tr>
  <tr>
    <td>
      <div id="fourChart"></div>
    </td>
    <td>
      <div id="fiveChart"></div>
    </td>
    <td>
      <div id="sixChart"></div>
    </td>
  </tr>
</table>


<script type='text/javascript'>//<![CDATA[

      google.charts.load('current', {
        'packages': ['gauge']
      });
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        var gaugeWidth = 450;
        var animationDuration = 90;

        var zeroData = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['zero', 0]
        ]);

        var oneData = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['one', 0]
        ]);

        var twoData = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['two', 0]
        ]);

        var threeData = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['three', 0]
        ]);

        var fourData = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['four', 0]
        ]);

        var fiveData = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['five', 0]
        ]);
        
        var sixData = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['six', 0]
        ]);
        
        var sevenData = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['seven', 0]
        ]);

        var zeroOptions = {
          min: 9000,
          max: 20000,
          width: gaugeWidth,
          animation: {
            duration: animationDuration,
            easing: 'linear',
          },
          hitmin: false,
          hitmax: false
        };

        var twoOptions = {
          min: -65792,
          max: 65792,
          width: gaugeWidth,
          animation: {
            duration: animationDuration,
            easing: 'linear',
          },
          hitmin: false,
          hitmax: false
        };

        var threeOptions = {
          min: -65792,
          max: 65792,
          width: gaugeWidth,
          animation: {
            duration: animationDuration,
            easing: 'linear',
          },
          hitmin: false,
          hitmax: false
        };

        var fourOptions = {
          min: -65792,
          max: 65792,
          width: gaugeWidth,
          animation: {
            duration: animationDuration,
            easing: 'linear',
          },
          hitmin: false,
          hitmax: false
        };

        var fiveOptions = {
          min: -65792,
          max: 65792,
          width: gaugeWidth,
          animation: {
            duration: animationDuration,
            easing: 'linear',
          },
          hitmin: false,
          hitmax: false
        };
        
        var sixOptions = {
          min: -65792,
          max: 65792,
          width: gaugeWidth,
          animation: {
            duration: animationDuration,
            easing: 'linear',
          },
          hitmin: false,
          hitmax: false
        };
        

        var zeroChart = new google.visualization.Gauge(document.getElementById('zeroChart'));
        var twoChart = new google.visualization.Gauge(document.getElementById('twoChart'));
        var threeChart = new google.visualization.Gauge(document.getElementById('threeChart'));
        var fourChart = new google.visualization.Gauge(document.getElementById('fourChart'));
        var fiveChart = new google.visualization.Gauge(document.getElementById('fiveChart'));
        var sixChart = new google.visualization.Gauge(document.getElementById('sixChart'));

        zeroChart.draw(zeroData, zeroOptions);
        twoChart.draw(twoData, twoOptions);
        threeChart.draw(threeData, threeOptions);
        fourChart.draw(fourData, fourOptions);
        fiveChart.draw(fiveData, fiveOptions);
        sixChart.draw(sixData, sixOptions);

        setInterval(function() {

          //zeroOptions = scale(zeroOptions, zero);
          zeroData.setValue(0, 1, zero);
          zeroChart.draw(zeroData, zeroOptions);

          //twoOptions = scale(twoOptions, two);
          twoData.setValue(0, 1, two);
          twoChart.draw(twoData, twoOptions);

          //threeOptions = scale(threeOptions, three);
          threeData.setValue(0, 1, three);
          threeChart.draw(threeData, threeOptions);

          //fourOptions = scale(fourOptions, four);
          fourData.setValue(0, 1, four);
          fourChart.draw(fourData, fourOptions);

          //fiveOptions = scale(fiveOptions, five);
          fiveData.setValue(0, 1, five);
          fiveChart.draw(fiveData, fiveOptions);

          //sixOptions = scale(sixOptions, six);
          sixData.setValue(0, 1, six);
          sixChart.draw(sixData, sixOptions);
        }, 100);
      }

//]]> 

</script>

</body>

</html>

